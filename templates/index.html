<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPU Monitor</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f0f2f5; color: #333; margin: 20px; }
        h1 { text-align: center; color: #1d3557; }
        .gpu-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
        .gpu-card { background-color: #fff; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); padding: 20px; width: 300px; }
        .gpu-card h2 { margin-top: 0; color: #457b9d; }
        .info-item { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .info-item span:first-child { font-weight: bold; }
        .progress-bar-container { background-color: #e9ecef; border-radius: .25rem; height: 20px; width: 100%; }
        .progress-bar { background-color: #2a9d8f; height: 100%; text-align: center; color: white; line-height: 20px; border-radius: .25rem; transition: width 0.5s ease-in-out; }
        .temp-bar { background: linear-gradient(to right, #66ff66, #ffff66, #ff6666); height: 100%; text-align: center; color: black; font-weight: bold; line-height: 20px; border-radius: .25rem; transition: width 0.5s ease-in-out; }
    </style>
</head>
<body>
    <h1>GPU Real-time Monitor</h1>
    <div id="gpu-container" class="gpu-container">
        <!-- GPU data will be loaded here -->
    </div>

    <script>
        function updateGpuInfo() {
            fetch('/api/gpu')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('gpu-container');
                    container.innerHTML = ''; // Clear previous data
                    if (data.length === 0 || data[0].error) {
                        container.innerHTML = '<p>Could not retrieve GPU data. Is a supported GPU driver installed?</p>';
                        return;
                    }
                    data.forEach(gpu => {
                        const card = document.createElement('div');
                        card.className = 'gpu-card';
                        card.innerHTML = `
                            <h2>${gpu.name}</h2>
                            <div class="info-item">
                                <span>Temperature:</span>
                                <span>${gpu.temperature}°C</span>
                            </div>
                            <div class="progress-bar-container">
                                <div class="temp-bar" style="width: ${gpu.temperature_raw}%">${gpu.temperature}°C</div>
                            </div>
                            <br>
                            <div class="info-item">
                                <span>GPU Load:</span>
                                <span>${gpu.load_percent}%</span>
                            </div>
                            <div class="progress-bar-container">
                                <div class="progress-bar" style="width: ${gpu.load_raw}%">${gpu.load_percent}%</div>
                            </div>
                            <br>
                            <div class="info-item">
                                <span>Memory Usage:</span>
                                <span>${gpu.memory_util_percent}%</span>
                            </div>
                             <div class="progress-bar-container">
                                <div class="progress-bar" style="width: ${gpu.memory_util_raw}%">${gpu.memory_util_percent}%</div>
                            </div>
                            <div class="info-item">
                                <span></span>
                                <span>${gpu.memory_used}MB / ${gpu.memory_total}MB</span>
                            </div>
                        `;
                        container.appendChild(card);
                    });
                })
                .catch(error => {
                    console.error('Error fetching GPU data:', error);
                    const container = document.getElementById('gpu-container');
                    container.innerHTML = '<p>Error fetching data. Check the console for details.</p>';
                });
        }

        // Update on page load and then every 2 seconds
        document.addEventListener('DOMContentLoaded', () => {
            updateGpuInfo();
            setInterval(updateGpuInfo, 2000);
        });
    </script>
</body>
</html>
